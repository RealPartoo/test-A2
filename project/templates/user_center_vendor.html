{% extends "base.html" %}
{% block title %}Manage My Artworks{% endblock %}

{% block content %}

<!-- Header + Upload -->
<div class="container-fluid mt-4 d-flex justify-content-between align-items-center">
  <h5 class="mb-0">Manage My Artworks</h5>
  <a href="{{ url_for('main.upload') }}" class="btn btn-dark btn-lg fw-semibold">+ Upload Artwork</a>
</div>

<!-- Grid -->
<div class="container py-4">
  <div class="row row-cols-1 row-cols-md-2 row-cols-lg-4 g-4">

    {% if artworks and artworks|length > 0 %}
      {% for art in artworks %}
      <div class="col">
        <div class="card h-100 shadow-sm border-0 rounded-4">

          <!-- image -->
          <div class="ratio ratio-16x9 bg-light">
            {# DB เก็บเป็น 'uploads/<file>' => เรียกผ่าน static #}
            <img src="{{ url_for('static', filename=art.imageUrl) }}"
                 class="img-fluid rounded-top"
                 alt="{{ art.title }}">
          </div>

          <!-- body -->
          <div class="card-body d-flex flex-column">

            <!-- title + status -->
            <div class="d-flex justify-content-between align-items-start mb-1">
              <h6 class="card-title mb-0">{{ art.title }}</h6>
              {% if (art.leaseStatus or '') == 'Available' %}
                <span class="badge rounded-pill text-bg-success">Available</span>
              {% else %}
                <span class="badge rounded-pill text-bg-secondary">Unavailable</span>
              {% endif %}
            </div>

            <!-- meta -->
            <p class="mb-0 small text-muted">
              {{ art.artistName }}{% if art.year %}, {{ art.year }}{% endif %}
            </p>
            <p class="mb-0 small text-muted">
              {{ art.galleryName or '-' }}
            </p>
            <p class="mb-2 fw-semibold">
              AUD {{ '%.2f'|format( (art.pricePerMonth|float) if art.pricePerMonth is not none else 0 ) }}
            </p>

            <!-- actions -->
<div class="mt-auto d-flex justify-content-end gap-2">
  <!-- Edit -->
  <a
    href="{{ url_for('main.item_edit', artwork_id=art.artworkId) }}"
    class="btn btn-outline-secondary btn-sm">
    Edit
  </a>

  <!-- Delete (POST) -->
  <form
    action="{{ url_for('main.item_delete', artwork_id=art.artworkId) }}"
    method="post"
    class="d-inline"
    onsubmit="return confirm('Delete this artwork?');">
    {# ถ้าใช้ Flask-WTF ให้ใส่ csrf_token ด้วย:
       <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
    #}
    <button type="submit" class="btn btn-outline-danger btn-sm">Delete</button>
  </form>
</div>

          </div>
        </div>
      </div>
      {% endfor %}
    {% else %}
      <div class="col-12">
        <div class="alert alert-light border">
          You haven’t uploaded any artworks yet.
          <a href="{{ url_for('main.upload') }}" class="ms-2">Upload now</a>
        </div>
      </div>
    {% endif %}

  </div>
</div>

{% endblock %}
